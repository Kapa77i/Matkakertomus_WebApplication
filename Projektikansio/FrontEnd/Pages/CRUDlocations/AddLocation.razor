@page "/locations/add/{User}"

@using System.Net.Http
@using System.Net.Http.Json
@using System.Threading.Tasks

@inject NavigationManager NavigationManager
@inject ILogger<Index> Logger
@inject HttpClient Http

<h1>Lisää matkakohde</h1>
@*sis. idmatkakohde, kohdenimi, maa, paikkakunta, kuvausteksti, kuva (id:tä ei tarvitse näyttää, ellei muokata tai poisteta)
    Alustava!

    KUINKA SAADA KUVA LISÄTTYÄ JA VÄLITETTYÄ??????
    Tee joku oletuskuva kaikille? ja/tai vetovalikko, mistä valita kuva?
*@
<a href="/locations">Matkakohteet</a>
@if(User != null){
    <div>
        <EditForm Model="@newlocation" OnValidSubmit="@PostLocations">
            <DataAnnotationsValidator/>
            <ValidationSummary/>
            <div>
                <label>Kuva
                    <InputText class="form-control" id="kuva" @bind-Value="newlocation.kuva"/>
                    <img src="tripPictures/@newlocation.kuva" width="133" height="133" alt="1" /> @*jos kuvaa ei valittu niin tässä ikoni*@
                </label>
            </div>
            <div>
                <label>Kohdenimi
                    <InputText class="form-control" id="kohdenimi" @bind-Value="newlocation.kohdenimi"/>
                </label>
            </div>
            <div>
                <label>Paikkakunta
                    <InputText class="form-control" id="paikkakunta" @bind-Value="newlocation.paikkakunta"/>
                </label>
            </div>
            <div>
                <label>
                    Maa
                    <InputText class="form-control" id="maa" @bind-Value="newlocation.maa" />
                </label>
            </div>
            <div>
                <label>Kuvausteksti
                    <InputText class="form-control" id="kuvausteksti" @bind-Value="newlocation.kuvausteksti"/>
                </label>
            </div>
            <button type="submit" class="btn btn-primary" disabled="@isSubmitting">Lisää</button>
        </EditForm>
    </div>
}
else {
    <h2>  <img src="/images/loading.gif" width="150" /></h2>
}

@code {
    [Parameter]
    public string? User { get; set; }

    bool isSubmitting;
    SharedLib.matkakohdeDTO newlocation = new SharedLib.matkakohdeDTO();


    async Task PostLocations(){

        if (User == null){//Tämä ei toimi vielä kunnolla, mutta ihan ok testaamisen ja toiminnallisen koodaamisen vuoksi
            NavigationManager.NavigateTo($"/login");//kuka tahansa ei voi lisätä matkakohteita, vaan pitää olla kirjautunut käyttäjä
        }
        else{
            isSubmitting = true;
            var result = await Http.PostAsJsonAsync($"api/Matkakohdes", newlocation); //vai api/Matkakohdes/{User}? Tarvitseeko käyttäjää merkitä?

            //saako tähän väliin pyöritettyä pyörää?
            NavigationManager.NavigateTo($"/locations");
        }
    }
}
