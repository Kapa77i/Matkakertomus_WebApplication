@page "/locations/edit/{Id:long}"

@using System.Net.Http
@using System.Net.Http.Json
@using System.Threading.Tasks

@inject NavigationManager NavigationManager
@inject ILogger<Index> Logger
@inject HttpClient Http
@inject SharedLib.LoginState loginState;

@*@Mahdollisuus lisätä kuva? Miten!?!?
    tee myös vetovalikko vaihtoehdoille*@

@if (loginState.isLoggedIn) { 

    @if (location != null)
    {
        <h3>@location.kohdenimi</h3>
        <div style="text-align:center">
            <EditForm Model="@location" OnValidSubmit="@EditLocations">
                <DataAnnotationsValidator />
                <ValidationSummary />
                <div>
                    <label>
                        Kuva
                        <InputText class="form-control" id="kuva" @bind-Value="location.kuva" />
                        <img src="tripPictures/@location.kuva" width="133" height="133" alt="1" />
                    </label>
                </div>
                <div>
                    <label>
                        Kohdenimi
                        <InputText class="form-control" id="kohdenimi" @bind-Value="location.kohdenimi" />
                    </label>
                </div>
                <div>
                    <label>
                        Paikkakunta
                        <InputText class="form-control" id="paikkakunta" @bind-Value="location.paikkakunta" />
                    </label>
                </div>
                <div>
                    <label>
                        Maa
                        <InputText class="form-control" id="maa" @bind-Value="location.maa" />
                    </label>
                </div>
                <div>
                    <label>
                        Kuvausteksti
                        <InputText class="form-control" id="kuvausteksti" @bind-Value="location.kuvausteksti" />
                    </label>
                </div>
                <button type="submit" class="btn btn-primary" disabled="@isSubmitting">Lisää</button>
            </EditForm>
        </div>
    }
    else
    {
        <h2>  <img src="/images/loading.gif" width="150" /></h2>
    }
    
}


@code {

    bool isSubmitting;
    SharedLib.matkakohdeDTO? location;

    [Parameter]
    public long? Id { get; set; }



    protected override async Task OnInitializedAsync()
    {

        location = await Http.GetFromJsonAsync<SharedLib.matkakohdeDTO>($"api/Matkakohdes/{Id}");

        await base.OnInitializedAsync(); 
    }


    async Task EditLocations()
    {

        /* if (!loginState.isLoggedIn)// <----------------------------------- EI välttämättä tarvita jos ylhäällä tarkistus
                {
                NavigationManager.NavigateTo($"/login");//kuka tahansa ei voi lisätä matkakohteita, vaan pitää olla kirjautunut käyttäjä
            }
            else
            { } */

                isSubmitting = true;
                //Console.WriteLine(location.idmatkakohde);
                var result = await Http.PutAsJsonAsync($"api/Matkakohdes/{Id}", location); //ERROR 400:   "The m field is required."
  
                //saako tähän väliin pyöritettyä pyörää?
                NavigationManager.NavigateTo($"/locations");

    }
}
