@page "/locations/delete/{Id:long}"
@*tarvitseeko myös user?*@

@using System.Net.Http
@using System.Net.Http.Json
@using System.Threading.Tasks

@inject NavigationManager NavigationManager
@inject ILogger<Index> Logger
@inject HttpClient Http
@inject SharedLib.LoginState loginState;

@if(!loginState.isLoggedIn){

    <h2>  <img src="/images/loading.gif" width="150" /></h2>
    <h2>Kirjaudu sisään poistaaksesi matkakohteita</h2>
}
else{
    
    @if (location != null)
    {
        <h2>@location.kohdenimi</h2>
        <h3>Haluatko varmasti poistaa matkakohteen?</h3>
        /*TARKISTA TYYLI*/
        <div style="text-align:center">
          @* @if (@location.kuva == null)
            {
                <div>Ei kuvaa saatavilla</div>
            }
            else
            {
                <div><img src="tripPictures/@location.kuva" width="133" height="133" alt="1" /></div>
            }
            <div>@location.kuva</div>
            <div>@location.kohdenimi</div>
            <div>@location.paikkakunta</div>
            <div>@location.maa</div>
            <div>@location.kuvausteksti</div>
            <br />
    <button type="submit" class="btn btn-danger" disabled="@isSubmitting" onclick="@DeleteLocations">Poista</button>*@



            <EditForm Model="@location" OnValidSubmit="@DeleteLocations">
                <DataAnnotationsValidator />
                <ValidationSummary />
                <div>
                    <label>
                        @if (@location.kuva == null)
                        {
                            <div>Ei kuvaa saatavilla</div>
                        }
                        else
                        {
                            <div style="text-align:center"><img src="tripPictures/@location.kuva" width="133" height="133" alt="1" /></div>
                        }
                        Kuva
                        <InputText class="form-control" id="kuva" disabled @bind-Value="location.kuva" />
                    </label>
                </div>
                <div>
                    <label>
                        Kohdenimi
                        <InputText class="form-control" id="kohdenimi" disabled @bind-Value="location.kohdenimi" />
                    </label>
                </div>
                <div>
                    <label>
                        Paikkakunta
                        <InputText class="form-control" id="paikkakunta" disabled @bind-Value="location.paikkakunta" />
                    </label>
                </div>
                <div>
                    <label>
                        Maa
                        <InputText class="form-control" id="maa" disabled @bind-Value="location.maa" />
                    </label>
                </div>
                <div>
                    <label>
                        Kuvausteksti
                        <InputText class="form-control" id="kuvausteksti" disabled @bind-Value="location.kuvausteksti" />
                    </label>
                </div>
                <button type="submit" class="btn btn-danger" disabled="@isSubmitting">Poista</button>
            </EditForm>
        </div>
    }
    else
    {
        <div style="text-align:center">Hupsista! <br />Jokin meni nyt vikaan. <br /> :( </div>
    }
}


@code {
    bool isSubmitting;
    SharedLib.matkakohdeDTO? location = new SharedLib.matkakohdeDTO();

    [Parameter]
    public string? User { get; set; }

    [Parameter]
    public long? Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var data = await Http.GetAsync($"api/Matkakohdes/{Id}");
        location = await data.Content.ReadFromJsonAsync<SharedLib.matkakohdeDTO>();

        await base.OnInitializedAsync();
    }

    private async Task DeleteLocations()
    {
        try{
            isSubmitting = true;
            var result = await Http.DeleteAsync($"api/Matkakohdes/{Id}");

            //saako tähän väliin pyöritettyä pyörää?
            NavigationManager.NavigateTo($"/locations");
        }
        catch(Exception e){
            Console.WriteLine(e.Message);
        }

    }
}
