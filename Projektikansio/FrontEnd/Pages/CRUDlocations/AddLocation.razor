@page "/locations/add"

@using System.Net.Http
@using System.Net.Http.Json
@using System.Threading.Tasks

@inject NavigationManager NavigationManager
@inject ILogger<Index> Logger
@inject HttpClient Http
@inject SharedLib.LoginState loginState;


@*sis. idmatkakohde, kohdenimi, maa, paikkakunta, kuvausteksti, kuva (id:tä ei tarvitse näyttää, ellei muokata tai poisteta)
    Alustava!

    KUINKA SAADA KUVA LISÄTTYÄ JA VÄLITETTYÄ??????
    Tee joku oletuskuva kaikille? ja/tai vetovalikko, mistä valita kuva?
*@

@if (loginState.isLoggedIn) @*kuka tahansa ei voi lisätä matkakohteita, vaan pitää olla kirjautunut käyttäjä*@
{
    <h1>Lisää matkakohde</h1>
    <div style="text-align:center">
        <EditForm Model="@newlocation" OnValidSubmit="@PostLocations">
            <DataAnnotationsValidator/>
            <ValidationSummary/>
            <div>
                <label>
                    @if (@newlocation.kuva == null)
                    {
                        <div>Ei kuvaa saatavilla</div>
                    }
                    else
                    {
                        <div style="text-align:center"><img src="tripPictures/@newlocation.kuva" width="133" height="133" alt="1" /> </div>
                    }
                    Kuva<br />
                    <InputText class="form-control" id="kuva" @bind-Value="newlocation.kuva" />
                </label>
            </div>
            <div>
                <label>Kohdenimi
                    <InputText class="form-control" id="kohdenimi" @bind-Value="newlocation.kohdenimi"/>
                </label>
            </div>
            <div>
                <label>Paikkakunta
                    <InputText class="form-control" id="paikkakunta" @bind-Value="newlocation.paikkakunta"/>
                </label>
            </div>
            <div>
                <label>
                    Maa
                    <InputText class="form-control" id="maa" @bind-Value="newlocation.maa" />
                </label>
            </div>
            <div>
                <label>Kuvausteksti
                    <InputTextArea class="form-control" id="kuvausteksti" @bind-Value="newlocation.kuvausteksti"/>
                </label>
            </div>
            <button type="submit" class="btn btn-primary" disabled="@isSubmitting">Lisää</button>
        </EditForm>
    </div>
}
else {
    <h2>  <img src="/images/loading.gif" width="150" /></h2>
    <h2>Kirjaudu sisään lisätäksesi matkakohteita</h2>
}

@code {

    bool isSubmitting;
    SharedLib.matkakohdeDTO newlocation = new SharedLib.matkakohdeDTO();

    async Task PostLocations(){

        try{
            
           isSubmitting = true;
           var result = await Http.PostAsJsonAsync($"api/Matkakohdes", newlocation);

           //saako tähän väliin pyöritettyä pyörää?
           NavigationManager.NavigateTo($"/locations");
            
        }
        catch(Exception e){
            Console.WriteLine(e.Message);
        }
        
    }
}
