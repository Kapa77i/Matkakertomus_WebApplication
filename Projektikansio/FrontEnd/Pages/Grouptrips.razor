@page "/grouptrips"
@using System.Net.Http
@using System.Net.Http.Json
@using System.Threading.Tasks
@inject HttpClient Http
@inject SharedLib.LoginState loginState

<link rel="stylesheet" type="text/css" href="css/app.css?version=0.1">




<h1>Porukan Matkat</h1>
@*voi selata (ei-yksityisiä) porukan matkoja ja niihin liitettyjä tarinoita ja kuvia*@

@if (tarinas == null && matkakohde == null)
{
    <h2>  <img src="/images/loading.gif" width="150" /></h2>
}
else
{

    <div class="flex-c">

        @foreach (var tarina in tarinas)
        {
            matka = matkas.FirstOrDefault(m => m.idmatka == tarina.idmatka);

            if (matka.yksityinen == 1)
            {
                matkakohde = matkakohdes.FirstOrDefault(m => m.idmatkakohde == tarina.idmatkakohde);

                <div>
                    <h4 style="text-align: left;">Matka nro @tarina.idmatka.ToString()</h4>
                    <img src="/tripPictures/@matkakohde.kuva" width="150" />
                    <p>Tarinan nro: @tarina.idtarina.ToString()</p>
                    <p>Tarinan kirjoitus pvm: @tarina.pvm.ToString().Replace("0.00.00", "")</p>
                    <p>Matkakohde: @matkakohde.kohdenimi</p>
                    <p>@tarina.teksti</p>
                    <a href="trips/edit/">Muokkaa</a>
                    <a href="trips/delete/">Poista</a>
                </div>


            }

        }

    </div>
}

@code {
    private List<SharedLib.kuvaDTO>? kuvatus;
    private List<SharedLib.tarinaDTO>? tarinas;
    private List<SharedLib.matkakohdeDTO>? matkakohdes;
    private List<SharedLib.matkaDTO>? matkas;
    private SharedLib.matkakohdeDTO matkakohde;
    private SharedLib.matkaDTO matka;


    public string Hidden { get; set; }

    protected override async Task OnInitializedAsync()
    {
        tarinas = await Http.GetFromJsonAsync<List<SharedLib.tarinaDTO>>("/api/Tarinas");
        matkakohdes = await Http.GetFromJsonAsync<List<SharedLib.matkakohdeDTO>>("/api/Matkakohdes");
        matkas = await Http.GetFromJsonAsync<List<SharedLib.matkaDTO>>("/api/Matkas");
    }


    protected void OnClick(MouseEventArgs mouseEventArgs)
    {
        
    }


}